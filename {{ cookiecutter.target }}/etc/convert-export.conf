{%- set z3blobs_active = false -%}
{% import 'db.conf' as db with context
%}{%- set db_blob_mode = cookiecutter.db_blobs_mode or cookiecutter.db_blob_mode%}
{%- set db_blob_location = cookiecutter.db_blobs_location or cookiecutter.db_blob_location
%}## Configuration file to export the configured storage to a FileStorage database.
# Use with: zodb-convert convert-export.conf
# For more information see https://pypi.org/project/zodb-convert/

{%- if cookiecutter.db_storage != "direct" and cookiecutter.db_convert_export_filestorage_location and cookiecutter.db_convert_export_blobs_location %}

{%- if cookiecutter.db_storage == "relstorage" %}

{{ db.relstorage(
    db_blob_mode,
    db_blob_location,
    cookiecutter.db_blob_cache_size,
    cookiecutter.db_blob_cache_size_check,
    cookiecutter.db_relstorage_keep_history,
    cookiecutter.db_relstorage_read_only,
    cookiecutter.db_relstorage_create_schema,
    cookiecutter.db_relstorage_commit_lock_timeout,
    cookiecutter.db_relstorage_blob_cache_size_check_external,
    cookiecutter.db_relstorage_blob_chunk_size,
    cookiecutter.db_relstorage_cache_local_mb,
    cookiecutter.db_relstorage_cache_local_object_max,
    cookiecutter.db_relstorage_cache_local_compression,
    cookiecutter.db_relstorage_cache_local_dir,
    cookiecutter.db_relstorage_cache_prefix,
    cookiecutter.db_relstorage_replica_conf,
    cookiecutter.db_relstorage_ro_replica_conf,
    cookiecutter.db_relstorage_replica_timeout,
    cookiecutter.db_relstorage_replica_revert_when_stale,
    cookiecutter.db_relstorage,
    cookiecutter.db_relstorage_postgresql_driver,
    cookiecutter.db_relstorage_postgresql_dsn,
    cookiecutter.db_relstorage_mysql_driver,
    cookiecutter.db_relstorage_mysql_parameters,
    cookiecutter.db_relstorage_oracle_driver,
    cookiecutter.db_relstorage_commit_lock_id,
    cookiecutter.db_relstorage_oracle_user,
    cookiecutter.db_relstorage_oracle_password,
    cookiecutter.db_relstorage_oracle_dsn,
    cookiecutter.db_relstorage_sqlite3_driver,
    cookiecutter.db_relstorage_sqlite3_data_dir,
    cookiecutter.db_relstorage_sqlite3_gevent_yield_interval,
    cookiecutter.db_relstorage_sqlite3_pragma,
    " source",
    cookiecutter.db_relstorage_name,
    cookiecutter.db_relstorage_pack_gc,
) }}

{%- elif cookiecutter.db_storage == "pgjsonb" %}

{{ db.pgjsonb(
    cookiecutter.db_pgjsonb_dsn,
    cookiecutter.db_pgjsonb_name,
    cookiecutter.db_pgjsonb_history_preserving,
    cookiecutter.db_pgjsonb_blob_temp_dir,
    cookiecutter.db_pgjsonb_cache_local_mb,
    cookiecutter.db_pgjsonb_pool_size,
    cookiecutter.db_pgjsonb_pool_max_size,
    cookiecutter.db_pgjsonb_pool_timeout,
    cookiecutter.db_pgjsonb_blob_threshold,
    cookiecutter.db_pgjsonb_s3_bucket_name,
    cookiecutter.db_pgjsonb_s3_prefix,
    cookiecutter.db_pgjsonb_s3_endpoint_url,
    cookiecutter.db_pgjsonb_s3_region,
    cookiecutter.db_pgjsonb_s3_access_key,
    cookiecutter.db_pgjsonb_s3_secret_key,
    cookiecutter.db_pgjsonb_s3_use_ssl,
    cookiecutter.db_pgjsonb_blob_cache_dir,
    cookiecutter.db_pgjsonb_blob_cache_size,
    tagmarker=" source",
) }}

{%- elif cookiecutter.db_storage == "zeo" %}

{{ db.zeo(
    db_blob_mode,
    db_blob_location,
    cookiecutter.db_blob_cache_size,
    cookiecutter.db_blob_cache_size_check,
    cookiecutter.db_zeo_server,
    cookiecutter.db_zeo_name,
    cookiecutter.db_zeo_client,
    cookiecutter.db_zeo_var,
    cookiecutter.db_zeo_cache_size,
    cookiecutter.db_zeo_username,
    cookiecutter.db_zeo_password,
    cookiecutter.db_zeo_realm,
    cookiecutter.db_zeo_read_only_fallback,
    cookiecutter.db_zeo_read_only,
    cookiecutter.db_zeo_drop_cache_rather_verify,
    cookiecutter.db_zeo_client_label,
    cookiecutter.db_zeo_storage,
    cookiecutter.db_zeo_wait,
    tagmarker=" source",
) }}

{%- endif %}

<filestorage destination>
    path {{ cookiecutter.db_convert_export_filestorage_location | abspath }}
    blob-dir {{ cookiecutter.db_convert_export_blobs_location | abspath }}
</filestorage>

{% else %}
# !!! Missing db_convert_export_* settings or storage is filestorage!
{%- endif %}

# This file was generated by cookiecutter-zope-instance {{ cookiecutter._version }}.
# for details follow https://github.com/plone/cookiecutter-zope-instance
