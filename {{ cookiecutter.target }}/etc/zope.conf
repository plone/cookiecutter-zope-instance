{%- set z3blobs_active = cookiecutter.db_z3blobs_enabled in [true, "true", "True"] -%}
{% import 'db.conf' as db with context %}{%-
set db_blob_mode = cookiecutter.db_blobs_mode or cookiecutter.db_blob_mode%}{%-
set db_blob_location = cookiecutter.db_blobs_location or cookiecutter.db_blob_location
%}# This file was generated by "cookiecutter-zope-instance"
%define INSTANCEHOME {{ cookiecutter.target | abspath }}
instancehome $INSTANCEHOME

%define CLIENTHOME {{ cookiecutter.location_clienthome | abspath }}
clienthome $CLIENTHOME

debug-mode {{ "on" if cookiecutter.debug_mode else "off" }}
debug-exceptions {{ "on" if cookiecutter.debug_exceptions else "off" }}
security-policy-implementation {{ "PYTHON" if cookiecutter.verbose_security else "C"}}
verbose-security {{ "on" if cookiecutter.verbose_security  else "off" }}
{%- if cookiecutter.http_realm != "Zope" %}
http-realm {{ cookiecutter.http_realm }}
{% endif %}
{%- if cookiecutter.max_conflict_retries != "3" %}
max-conflict-retries {{ cookiecutter.max_conflict_retries }}
{% endif %}
{%- if cookiecutter.webdav_source_port != "0" %}
webdav-source-port {{ cookiecutter.webdav_source_port }}
{% endif %}
{%- if cookiecutter.locale %}
locale {{ cookiecutter.locale }}
{% endif %}
default-zpublisher-encoding utf-8
{%- if not cookiecutter.enable_xmlrpc %}
enable-xmlrpc off
{% endif %}
{%- if cookiecutter.enable_ms_public_header %}
enable-ms-public-header on
{% endif %}


{%- if cookiecutter.environment %}

<environment>
{%- for key, value in cookiecutter.environment|dictsort %}
{%- if key in cookiecutter.environment_paths %}
    {{ key }} {{ value | abspath}}
{%- else %}
    {{ key }} {{ value }}
{%- endif %}
{%- endfor %}
</environment>
{%- endif %}

{%- if cookiecutter.dos_protection_available %}
<dos_protection>
    form-memory-limit {{ cookiecutter.dos_protection_form_memory_limit }}
    form-disk-limit {{ cookiecutter.dos_protection_form_disk_limit }}
    form-memfile-limit {{ cookiecutter.dos_protection_form_memfile_limit }}
</dos_protection>
{%- endif %}

# Database
<zodb_db main>
    mount-point /
    cache-size {{ cookiecutter.db_cache_size }}
{%- if cookiecutter.db_cache_size_bytes %}
    cache-size-bytes {{ cookiecutter.db_cache_size_bytes }}
{%- endif %}
{%- if cookiecutter.db_large_record_size %}
    large-record-size {{ cookiecutter.db_large_record_size }}
{%- endif %}
{%- if cookiecutter.db_pool_size %}
    pool-size {{ cookiecutter.db_pool_size }}
{%- endif %}
{%- if z3blobs_active %}
    {{ db.z3blobs_open(
        cookiecutter.db_z3blobs_bucket_name,
        cookiecutter.db_z3blobs_s3_prefix,
        cookiecutter.db_z3blobs_s3_endpoint_url,
        cookiecutter.db_z3blobs_s3_region,
        cookiecutter.db_z3blobs_s3_access_key,
        cookiecutter.db_z3blobs_s3_secret_key,
        cookiecutter.db_z3blobs_s3_use_ssl,
        cookiecutter.db_z3blobs_s3_addressing_style,
        cookiecutter.db_z3blobs_s3_sse_customer_key,
        cookiecutter.db_z3blobs_cache_dir,
        cookiecutter.db_z3blobs_cache_size,
    ) }}
{%- endif %}
{%- if cookiecutter.db_storage == "direct" %}
    {{ db.filestorage(
        cookiecutter.db_filestorage_location,
        cookiecutter.db_blob_location,
        cookiecutter.db_filestorage_pack_keep_old,
        cookiecutter.db_filestorage_quota,
        cookiecutter.db_filestorage_packer,
        cookiecutter.db_filestorage_pack_gc
    ) }}
{%- endif %}
{%- if cookiecutter.db_storage == "relstorage" %}
{% filter indent(width=4) %}
    {{ db.relstorage(
        db_blob_mode,
        db_blob_location,
        cookiecutter.db_blob_cache_size,
        cookiecutter.db_blob_cache_size_check,
        cookiecutter.db_relstorage_keep_history,
        cookiecutter.db_relstorage_read_only,
        cookiecutter.db_relstorage_create_schema,
        cookiecutter.db_relstorage_commit_lock_timeout,
        cookiecutter.db_relstorage_blob_cache_size_check_external,
        cookiecutter.db_relstorage_blob_chunk_size,
        cookiecutter.db_relstorage_cache_local_mb,
        cookiecutter.db_relstorage_cache_local_object_max,
        cookiecutter.db_relstorage_cache_local_compression,
        cookiecutter.db_relstorage_cache_local_dir,
        cookiecutter.db_relstorage_cache_prefix,
        cookiecutter.db_relstorage_replica_conf,
        cookiecutter.db_relstorage_ro_replica_conf,
        cookiecutter.db_relstorage_replica_timeout,
        cookiecutter.db_relstorage_replica_revert_when_stale,
        cookiecutter.db_relstorage,
        cookiecutter.db_relstorage_postgresql_driver,
        cookiecutter.db_relstorage_postgresql_dsn,
        cookiecutter.db_relstorage_mysql_driver,
        cookiecutter.db_relstorage_mysql_parameters,
        cookiecutter.db_relstorage_oracle_driver,
        cookiecutter.db_relstorage_commit_lock_id,
        cookiecutter.db_relstorage_oracle_user,
        cookiecutter.db_relstorage_oracle_password,
        cookiecutter.db_relstorage_oracle_dsn,
        cookiecutter.db_relstorage_sqlite3_driver,
        cookiecutter.db_relstorage_sqlite3_data_dir,
        cookiecutter.db_relstorage_sqlite3_gevent_yield_interval,
        cookiecutter.db_relstorage_sqlite3_pragma,
        ""
    ) }}
{% endfilter %}
{%- endif %}
{%- if cookiecutter.db_storage == "zeo" %}
    {{ db.zeo(
        db_blob_mode,
        db_blob_location,
        cookiecutter.db_blob_cache_size,
        cookiecutter.db_blob_cache_size_check,
        cookiecutter.db_zeo_server,
        cookiecutter.db_zeo_name,
        cookiecutter.db_zeo_client,
        cookiecutter.db_zeo_var,
        cookiecutter.db_zeo_cache_size,
        cookiecutter.db_zeo_username,
        cookiecutter.db_zeo_password,
        cookiecutter.db_zeo_realm,
        cookiecutter.db_zeo_read_only_fallback,
        cookiecutter.db_zeo_read_only,
        cookiecutter.db_zeo_drop_cache_rather_verify,
    ) }}
{%- endif %}
{%- if cookiecutter.db_storage == "pgjsonb" %}
    {{ db.pgjsonb(
        cookiecutter.db_pgjsonb_dsn,
        cookiecutter.db_pgjsonb_name,
        cookiecutter.db_pgjsonb_history_preserving,
        cookiecutter.db_pgjsonb_blob_temp_dir,
        cookiecutter.db_pgjsonb_cache_local_mb,
        cookiecutter.db_pgjsonb_pool_size,
        cookiecutter.db_pgjsonb_pool_max_size,
        cookiecutter.db_pgjsonb_pool_timeout,
        cookiecutter.db_pgjsonb_blob_threshold,
        cookiecutter.db_pgjsonb_s3_bucket_name,
        cookiecutter.db_pgjsonb_s3_prefix,
        cookiecutter.db_pgjsonb_s3_endpoint_url,
        cookiecutter.db_pgjsonb_s3_region,
        cookiecutter.db_pgjsonb_s3_access_key,
        cookiecutter.db_pgjsonb_s3_secret_key,
        cookiecutter.db_pgjsonb_s3_use_ssl,
        cookiecutter.db_pgjsonb_blob_cache_dir,
        cookiecutter.db_pgjsonb_blob_cache_size,
    ) }}
{%- endif %}
{%- if z3blobs_active %}
    {{ db.z3blobs_close() }}
{%- endif %}
</zodb_db>

# This file was generated by cookiecutter-zope-instance {{ cookiecutter._version }}.
# for details follow https://github.com/plone/cookiecutter-zope-instance
